{
  "permissions": {
    "allow": [
      "Bash(git fetch:*)",
      "Bash(git checkout:*)",
      "Bash(uv run pytest:*)",
      "mcp__github__get_me",
      "WebSearch",
      "mcp__context7__resolve-library-id",
      "mcp__context7__query-docs",
      "Bash(.specify/scripts/powershell/create-new-feature.ps1 -Json \"PHASE II — BACKEND SPECIFICATION \\(FASTAPI\\)\n\nObjective  \nImplement a secure, production-ready backend for a multi-user Todo web application. The backend must expose RESTful APIs, enforce authentication using JWT, persist data in PostgreSQL, and strictly isolate user data. All implementation must be performed by Claude Code using this specification as the source of truth.\n\nTechnology Stack  \n- Python FastAPI  \n- SQLModel ORM  \n- Neon Serverless PostgreSQL  \n- JWT-based authentication \\(tokens issued by Better Auth on frontend\\)\n\n────────────────────────────────────────\nCORE RESPONSIBILITIES\n────────────────────────────────────────\n\n1. Expose RESTful APIs for task management  \n2. Verify and enforce user authentication using JWT  \n3. Persist and query data from PostgreSQL  \n4. Enforce strict per-user data isolation  \n5. Return consistent JSON responses and proper HTTP status codes  \n\n────────────────────────────────────────\nAUTHENTICATION & SECURITY\n────────────────────────────────────────\n\nJWT Verification  \n- Every API request must include a JWT token in the Authorization header  \n  Authorization: Bearer <token>  \n- Backend must verify the JWT signature using a shared secret  \n- JWT verification must occur before request handling  \n- Invalid or missing token must return 401 Unauthorized  \n\nUser Identity Extraction  \n- Backend must decode the JWT token to extract:  \n  - user_id  \n  - email  \n- Backend must treat JWT data as the single source of user identity  \n\nAuthorization Rules  \n- user_id extracted from JWT must match user_id provided in request path  \n- Mismatch must return 403 Forbidden  \n- Backend must never trust client-provided user_id without JWT verification  \n\nToken Properties  \n- JWT must support expiration  \n- Expired tokens must be rejected automatically  \n\n────────────────────────────────────────\nAPI ENDPOINTS\n────────────────────────────────────────\n\nAll endpoints require a valid JWT token.\n\nGET /api/{user_id}/tasks  \n- Return all tasks belonging to the authenticated user  \n- Must filter tasks by user_id from JWT  \n- Response: list of task objects  \n\nPOST /api/{user_id}/tasks  \n- Create a new task for the authenticated user  \n- Request body:  \n  - title \\(required, 1–200 chars\\)  \n  - description \\(optional, max 1000 chars\\)  \n- Response: created task object  \n\nGET /api/{user_id}/tasks/{task_id}  \n- Return task details if task belongs to user  \n- If task not found or not owned by user, return 404  \n\nPUT /api/{user_id}/tasks/{task_id}  \n- Update task title, description, or completed status  \n- Only allowed if task belongs to authenticated user  \n- Response: updated task object  \n\nDELETE /api/{user_id}/tasks/{task_id}  \n- Delete task owned by authenticated user  \n- Response: success confirmation  \n\nPATCH /api/{user_id}/tasks/{task_id}/complete  \n- Toggle completed status of task  \n- Only allowed if task belongs to authenticated user  \n- Response: updated task object  \n\n────────────────────────────────────────\nDATA MODEL REQUIREMENTS\n────────────────────────────────────────\n\nUser  \n- Managed externally by Better Auth  \n- Fields used by backend:  \n  - id \\(string\\)  \n  - email \\(string\\)  \n\nTask  \n- id: integer \\(primary key\\)  \n- user_id: string \\(foreign key reference to user\\)  \n- title: string \\(not null\\)  \n- description: text \\(nullable\\)  \n- completed: boolean \\(default false\\)  \n- created_at: timestamp  \n- updated_at: timestamp  \n\nIndexes  \n- Index on user_id for fast filtering  \n- Index on completed for status queries  \n\n────────────────────────────────────────\nDATABASE BEHAVIOR\n────────────────────────────────────────\n\n- All database operations must use SQLModel  \n- Database connection string must be loaded from environment variables  \n- Queries must always be filtered by authenticated user_id  \n- Backend must never return tasks belonging to another user  \n\n────────────────────────────────────────\nERROR HANDLING\n────────────────────────────────────────\n\n- 401 Unauthorized: missing or invalid JWT  \n- 403 Forbidden: user_id mismatch or unauthorized access  \n- 404 Not Found: task does not exist or not owned by user  \n- 422 Validation Error: invalid request data  \n- Errors must return JSON responses with clear messages  \n\n────────────────────────────────────────\nIMPLEMENTATION RULES\n────────────────────────────────────────\n\n- This specification is the single source of truth  \n- Claude Code must read and follow this spec before implementation  \n- No manual code edits are permitted  \n- Any behavior change must be reflected in this spec first  \n\n────────────────────────────────────────\nSUCCESS CRITERIA\n────────────────────────────────────────\n\n- All endpoints require JWT authentication  \n- User identity is derived exclusively from JWT  \n- Tasks are fully isolated per user  \n- CRUD operations function correctly  \n- Database persistence works across restarts  \n- Backend is secure, stateless, and production-ready  \n\n────────────────────────────────────────\nFolder Structure\n────────────────────────────────────────\n\n-Root/Backend \\(All work here in Backend Folder\\)\n\n────────────────────────────────────────\nCode\n────────────────────────────────────────\n\n-Code Should be simple and easy to understand even for beginner\n\n\n\nEND OF PHASE II BACKEND SPEC\" -Json -Number 2 -ShortName \"backend-jwt-auth\" \"Backend JWT Authentication API\")",
      "Bash(.specify/scripts/powershell/check-prerequisites.ps1 -Json -PathsOnly)",
      "Bash(.specify/scripts/powershell/setup-plan.ps1:*)",
      "Bash(.specify/scripts/powershell/check-prerequisites.ps1:*)",
      "Bash(python test_app.py:*)"
    ]
  }
}
